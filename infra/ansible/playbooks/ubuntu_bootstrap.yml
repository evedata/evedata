---
- name: Harden operating system
  tags: os
  hosts: "{{ target_hosts | default('ubuntu') }}"
  become: true
  become_user: root
  gather_facts: true
  roles:
    - devsec.hardening.os_hardening
  vars:
    os_ignore_users:
      - ansible
    sysctl_overwrite:
      net.ipv4.ip_forward: 1 # For routing VMs/containers
      vm.panic_on_oom: 0
      vm.overcommit_memory: 1
      kernel.panic: 10
      kernel.panic_on_oops: 1
      kernel.keys.root_maxkeys: 1000000
      kernel.keys.root_maxbytes: 25000000

- name: Harden SSH
  tags: ssh
  hosts: "{{ target_hosts | default('ubuntu') }}"
  become: true
  become_user: root
  gather_facts: true
  roles:
    - devsec.hardening.ssh_hardening
  vars:
    network_ipv6_enable: false
    sftp_enabled: false
