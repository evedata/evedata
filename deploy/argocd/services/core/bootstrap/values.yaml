---
# Default values for bootstrap chart

# ArgoCD configuration
argocd:
  namespace: argocd
  project: hzl

# Target cluster configuration
destination:
  server: https://kubernetes.default.svc

# Global sync policy defaults
# Individual applications can override these settings
syncPolicy:
  # Enable automated sync - applications will automatically sync when git changes are detected
  automated:
    # Enable self-healing - applications will be synced if they drift from desired state
    selfHeal: true
    # Enable auto-pruning - resources will be deleted if removed from git
    prune: true
  # Sync options applied to all applications
  syncOptions:
    - CreateNamespace=true # Automatically create namespaces if they don't exist
    - PruneLast=true # Prune resources as a final step (safer for dependencies)
  # Retry policy for failed syncs
  retry:
    limit: 5
    backoff:
      duration: 5s
      factor: 2
      maxDuration: 3m

loki:
  enabled: true
  namespace: loki
  chart:
    repoURL: https://grafana.github.io/helm-charts
    chart: loki
    targetRevision: "6.42.0"
  values:
    global:
      extraArgs:
        - -config.expand-env=true
        - -print-config-stderr=true
      extraEnvFrom:
        - secretRef:
            name: loki-config-env
    loki:
      commonConfig:
        replication_factor: 1
      schemaConfig:
        configs:
          - from: "2024-04-01"
            store: tsdb
            object_store: s3
            schema: v13
            index:
              prefix: loki_index_
              period: 24h
      pattern_ingester:
        enabled: true
      limits_config:
        allow_structured_metadata: true
        volume_enabled: true
        retention_period: 672h # 28 days retention
      ruler:
        enable_api: true
      storage_config:
        aws:
          region: weur
          bucketnames: hzl-loki-chunk-weur
          s3forcepathstyle: true
      storage:
        type: s3
        bucketNames:
          chunks: hzl-loki-chunk-weur
          ruler: hzl-loki-ruler-weur
        s3:
          endpoint: "${LOKI_STORAGE_S3_ENDPOINT}"
          region: weur
          accessKeyId: "${LOKI_STORAGE_S3_ACCESS_KEY_ID}"
          secretAccessKey: "${LOKI_STORAGE_S3_SECRET_ACCESS_KEY}"
          signatureVersion: v4
          s3ForcePathStyle: true
          insecure: false
    deploymentMode: SingleBinary
    singleBinary:
      replicas: 1
    backend:
      replicas: 0
    read:
      replicas: 0
    write:
      replicas: 0
    ingester:
      replicas: 0
    querier:
      replicas: 0
    queryFrontend:
      replicas: 0
    queryScheduler:
      replicas: 0
    distributor:
      replicas: 0
    compactor:
      replicas: 0
    indexGateway:
      replicas: 0
    bloomCompactor:
      replicas: 0
    bloomGateway:
      replicas: 0
    minio:
      enabled: false
lokiConfig:
  enabled: true
  namespace: loki
  chart:
    repoURL: https://github.com/evedata/evedata.git
    path: deploy/argocd/services/core/loki-config
    targetRevision: HEAD
